site-metrics-by-source:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - $ref: './parameters.yaml#/source'
    - $ref: './parameters.yaml#/metric'
  get:
    tags:
      - metrics
      - site
    summary: Retrieve site metrics by source
    description: |
      This endpoint is useful for retrieving site metrics by source.
    operationId: getSiteMetricsBySource
    responses:
      '200':
        description: A list of site metrics
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteMetricList'
      '400':
        $ref: './responses.yaml#/400-no-site-id'
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
page-metrics-by-source:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - $ref: './parameters.yaml#/source'
    - $ref: './parameters.yaml#/metric'
    - $ref: './parameters.yaml#/base64PageUrl'
  get:
    tags:
      - metrics
      - site
    summary: Retrieve page metrics by source
    description: |
      This endpoint is useful for retrieving page metrics by source.
      Currently only `organic-keywords` is supported as a metric and only for source `ahrefs`.
    operationId: getPageMetricsBySource
    responses:
      '200':
        description: A list of page metrics
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/PageMetricList'
      '400':
        $ref: './responses.yaml#/400-no-site-id'
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
site-metrics-latest:
  get:
    operationId: getSiteLatestMetrics
    summary: Get latest site metrics
    description: |
      Retrieves the latest metrics for a specific site, including RUM (Real User Monitoring)
      data and organic traffic metrics. Returns zeroed values if no data is available or
      no RUM domain key is configured.
    parameters:
      - $ref: './parameters.yaml#/siteId'
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              type: object
              properties:
                pageViewsChange:
                  type: number
                  description: Percentage change in page views compared to the previous period
                ctrChange:
                  type: number
                  description: Percentage change in Click-Through Rate (CTR) compared to the previous period
                projectedTrafficValue:
                  type: number
                  description: Projected traffic value based on page views change and cost per click
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
    tags:
      - metrics
      - site
site-comprehensive-metrics:
  get:
    operationId: getSiteComprehensiveMetrics
    summary: Get comprehensive site metrics
    description: |
      Retrieves comprehensive metrics for a site including audits, opportunities, and suggestions.
      Supports optional date range filtering to analyze metrics over a specific time period.
      
      Returns:
      - Audit execution statistics (total, successful, failed, success rate)
      - Breakdown of audits by type
      - Opportunities generated by type
      - Suggestions created by status
    parameters:
      - $ref: './parameters.yaml#/siteId'
      - name: startDate
        in: query
        description: Start date for metrics (YYYY-MM-DD format). Defaults to '2000-01-01' if not provided.
        required: false
        schema:
          type: string
          format: date
          example: "2025-01-01"
      - name: endDate
        in: query
        description: End date for metrics (YYYY-MM-DD format). Defaults to today if not provided.
        required: false
        schema:
          type: string
          format: date
          example: "2025-01-31"
    responses:
      '200':
        description: Successful response with comprehensive metrics
        content:
          application/json:
            schema:
              type: object
              properties:
                siteId:
                  type: string
                  format: uuid
                  description: The site ID
                baseURL:
                  type: string
                  format: uri
                  description: The base URL of the site
                startDate:
                  type: string
                  format: date
                  description: Start date of the metrics period
                endDate:
                  type: string
                  format: date
                  description: End date of the metrics period
                audits:
                  type: object
                  properties:
                    total:
                      type: integer
                      description: Total number of audits executed
                    successful:
                      type: integer
                      description: Number of successful audits
                    failed:
                      type: integer
                      description: Number of failed audits
                    successRate:
                      type: number
                      format: float
                      description: Success rate as a percentage
                    byType:
                      type: object
                      additionalProperties:
                        type: object
                        properties:
                          total:
                            type: integer
                          successful:
                            type: integer
                          failed:
                            type: integer
                      description: Breakdown of audits by type
                opportunities:
                  type: object
                  properties:
                    total:
                      type: integer
                      description: Total number of opportunities generated
                    byType:
                      type: object
                      additionalProperties:
                        type: integer
                      description: Breakdown of opportunities by type
                suggestions:
                  type: object
                  properties:
                    total:
                      type: integer
                      description: Total number of suggestions created
                    byStatus:
                      type: object
                      additionalProperties:
                        type: integer
                      description: Breakdown of suggestions by status
            example:
              siteId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
              baseURL: "https://example.com"
              startDate: "2025-01-01"
              endDate: "2025-01-31"
              audits:
                total: 100
                successful: 95
                failed: 5
                successRate: 95.0
                byType:
                  cwv:
                    total: 50
                    successful: 48
                    failed: 2
                  seo:
                    total: 50
                    successful: 47
                    failed: 3
              opportunities:
                total: 25
                byType:
                  seo-backlinks: 15
                  cwv-lcp: 10
              suggestions:
                total: 50
                byStatus:
                  NEW: 30
                  APPROVED: 15
                  REJECTED: 5
      '400':
        description: Bad request - Invalid site ID or date format
        content:
          application/json:
            schema:
              type: string
            examples:
              invalidSiteId:
                value: "Invalid site ID format"
              invalidStartDate:
                value: "Invalid start date format. Use YYYY-MM-DD format."
              invalidEndDate:
                value: "Invalid end date format. Use YYYY-MM-DD format."
              invalidDateRange:
                value: "Start date must be before or equal to end date."
      '401':
        $ref: './responses.yaml#/401'
      '403':
        description: Forbidden - User does not have access to the site
        content:
          application/json:
            schema:
              type: string
            example: "User does not have access to site a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
    tags:
      - metrics
      - site
