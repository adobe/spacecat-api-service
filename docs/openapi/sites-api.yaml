site-brand-profile:
  parameters:
    - name: siteId
      in: path
      required: true
      description: ID of the site whose brand profile should be fetched or updated
      schema:
        $ref: './schemas.yaml#/Id'
  get:
    tags:
      - site
    summary: Get the brand profile for a site
    operationId: getBrandProfile
    responses:
      '200':
        description: Brand profile found
        content:
          application/json:
            schema:
              type: object
              properties:
                brandProfile:
                  $ref: './schemas.yaml#/BrandProfile'
      '204':
        description: Site exists but no brand profile has been generated yet
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '403':
        $ref: './responses.yaml#/403'
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
      - ims_key: [ ]
      - scoped_api_key: [ ]
  post:
    tags:
      - site
    summary: Trigger a brand-profile agent run for a site
    operationId: triggerBrandProfileUpdate
    description: |
      Starts the asynchronous brand-profile agent workflow for the specified site. The caller receives a 202 response containing the Step Functions execution name.
    responses:
      '202':
        description: Request accepted and queued.
        content:
          application/json:
            schema:
              type: object
              properties:
                executionName:
                  type: string
                  description: Name of the Step Functions execution
                siteId:
                  $ref: './schemas.yaml#/Id'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '403':
        $ref: './responses.yaml#/403'
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites:
  post:
    tags:
      - site
    summary: Create a new site
    description: |
      This endpoint is useful for creating a new site.
    operationId: createSite
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/SiteCreate'
    responses:
      '201':
        description: Site created successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/Site'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - admin_key: [ ]
  get:
    tags:
      - site
    summary: Retrieve all sites
    description: |
      This endpoint is useful for retrieving all sites.
    operationId: getSites
    responses:
      '200':
        description: A list of sites
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteList'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites-by-delivery-type:
  parameters:
    - $ref: './parameters.yaml#/deliveryType'
  get:
    tags:
      - site
    summary: Retrieve all sites by delivery type
    description: |
      This endpoint is useful for retrieving all sites by delivery type.
    operationId: getSitesByDeliveryType
    responses:
      '200':
        description: A list of sites
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteList'
      '400':
        $ref: './responses.yaml#/400-no-delivery-type'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites-with-latest-audit:
  parameters:
    - $ref: './parameters.yaml#/auditType'
  get:
    tags:
      - site
    summary: Retrieve all sites including their latest audit
    description: |
      This endpoint is useful for retrieving all sites including their latest audit.
      The latest audit is determined by the auditedAt property of the audit and
      included in the audits array of the site object.
    operationId: getSitesWithLatestAudit
    responses:
      '200':
        description: A list of sites with their latest audit
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteWithLatestAuditList'
      '400':
        $ref: './responses.yaml#/400-no-audit-type'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites-for-organization:
  parameters:
    - $ref: './parameters.yaml#/organizationId'
  get:
    tags:
      - organization
      - site
    summary: Retrieve all sites for an organization
    description: |
      This endpoint is useful for retrieving all sites for an organization.
    operationId: getSitesForOrganization
    responses:
      '200':
        description: A list of sites
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteList'
      '400':
        $ref: './responses.yaml#/400-no-organization-id'
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404-organization-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
      - ims_key: [ ]
      - scoped_api_key: [ ]

sites-by-organization-and-project-name:
  parameters:
    - name: organizationId
      in: path
      description: The ID of the organization
      required: true
      schema:
        $ref: './schemas.yaml#/Id'
    - name: projectName
      in: path
      description: The name of the project
      required: true
      schema:
        type: string
  get:
    tags:
      - site
    summary: Retrieve all sites by organization ID and project name
    description: |
      This endpoint is useful for retrieving all sites belonging to a specific project within an organization, identified by project name.
    operationId: getSitesByOrganizationIdAndProjectName
    responses:
      '200':
        description: A list of sites for the project
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: './schemas.yaml#/Site'
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
      - ims_key: [ ]
      - scoped_api_key: [ ]

sites-resolve:
  get:
    tags:
      - site
    summary: Resolve site and organization data
    description: |
      This endpoint resolves site and organization data based on flexible query parameters.
      It supports resolution by organization ID, IMS organization ID, or specific site ID.
      The endpoint validates entitlements and enrollments for the specified product code.
      
      **Resolution Logic:**
      1. If `siteId` is provided, validates the site against the organization
      2. Otherwise, resolves by `organizationId` or `imsOrg`
      3. Returns the first enrolled site with matching entitlement
      
    operationId: resolveSite
    parameters:
      - name: organizationId
        in: query
        required: false
        description: UUID of the organization (mutually exclusive with imsOrg)
        schema:
          $ref: './schemas.yaml#/Id'
      - name: imsOrg
        in: query
        required: false
        description: IMS Organization ID (mutually exclusive with organizationId)
        schema:
          $ref: './schemas.yaml#/ImsOrganizationId'
      - name: siteId
        in: query
        required: false
        description: UUID of a specific site to validate against the organization
        schema:
          $ref: './schemas.yaml#/Id'
    responses:
      '200':
        description: Successfully resolved site and organization data
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
                  properties:
                    organization:
                      $ref: './schemas.yaml#/Organization'
                    site:
                      $ref: './schemas.yaml#/Site'
              example:
                data:
                  organization:
                    id: '9033554c-de8a-44ac-a356-09b51af8cc28'
                    name: 'Example Organization'
                    imsOrgId: '1234567890ABCDEF12345678@AdobeOrg'
                    config: {}
                  site:
                    id: '0b4dcf79-fe5f-410b-b11f-641f0bf56da3'
                    baseURL: 'https://example.com'
                    organizationId: '9033554c-de8a-44ac-a356-09b51af8cc28'
                    deliveryType: 'aem_edge'
                    isLive: true
      '400':
        description: Bad request - missing required parameters or invalid input
        headers:
          X-Error:
            $ref: './headers.yaml#/xError'
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
            examples:
              missing-product-code:
                summary: Missing x-product header
                value:
                  message: 'Product code required in x-product header'
              missing-org-params:
                summary: Missing organization parameters
                value:
                  message: 'Either organizationId or imsOrg must be provided'
              resolution-failed:
                summary: Failed to resolve site
                value:
                  message: 'Failed to resolve site'
      '404':
        description: Not found - no site found for the provided parameters
        headers:
          X-Error:
            $ref: './headers.yaml#/xError'
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
            example:
              message: 'No site found for the provided parameters'
      '500':
        description: Internal server error
        headers:
          X-Error:
            $ref: './headers.yaml#/xError'
    security:
      - ims_key: [ ]
      - scoped_api_key: [ ]
