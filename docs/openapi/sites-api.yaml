site-brand-profile:
  parameters:
    - name: siteId
      in: path
      required: true
      description: ID of the site whose brand profile should be fetched or updated
      schema:
        $ref: './schemas.yaml#/Id'
  get:
    tags:
      - site
    summary: Get the brand profile for a site
    operationId: getBrandProfile
    responses:
      '200':
        description: Brand profile found
        content:
          application/json:
            schema:
              type: object
              properties:
                brandProfile:
                  $ref: './schemas.yaml#/BrandProfile'
      '204':
        description: Site exists but no brand profile has been generated yet
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '403':
        $ref: './responses.yaml#/403'
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
      - ims_key: [ ]
      - scoped_api_key: [ ]
  post:
    tags:
      - site
    summary: Trigger a brand-profile agent run for a site
    operationId: triggerBrandProfileUpdate
    description: |
      Starts the asynchronous brand-profile agent workflow for the specified site. The caller receives a 202 response containing the Step Functions execution name.
    requestBody:
      required: false
      content:
        application/json:
          schema:
            type: object
            properties:
              idempotencyKey:
                type: string
                description: Optional caller-provided key for deduplication.
                example: "manual-trigger-001"
    responses:
      '202':
        description: Request accepted and queued.
        content:
          application/json:
            schema:
              type: object
              properties:
                executionName:
                  type: string
                  description: Name of the Step Functions execution
                siteId:
                  $ref: './schemas.yaml#/Id'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '403':
        $ref: './responses.yaml#/403'
      '404':
        $ref: './responses.yaml#/404-site-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites:
  post:
    tags:
      - site
    summary: Create a new site
    description: |
      This endpoint is useful for creating a new site.
    operationId: createSite
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/SiteCreate'
    responses:
      '201':
        description: Site created successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/Site'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - admin_key: [ ]
  get:
    tags:
      - site
    summary: Retrieve all sites
    description: |
      This endpoint is useful for retrieving all sites.
    operationId: getSites
    responses:
      '200':
        description: A list of sites
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteList'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites-by-delivery-type:
  parameters:
    - $ref: './parameters.yaml#/deliveryType'
  get:
    tags:
      - site
    summary: Retrieve all sites by delivery type
    description: |
      This endpoint is useful for retrieving all sites by delivery type.
    operationId: getSitesByDeliveryType
    responses:
      '200':
        description: A list of sites
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteList'
      '400':
        $ref: './responses.yaml#/400-no-delivery-type'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites-with-latest-audit:
  parameters:
    - $ref: './parameters.yaml#/auditType'
  get:
    tags:
      - site
    summary: Retrieve all sites including their latest audit
    description: |
      This endpoint is useful for retrieving all sites including their latest audit.
      The latest audit is determined by the auditedAt property of the audit and
      included in the audits array of the site object.
    operationId: getSitesWithLatestAudit
    responses:
      '200':
        description: A list of sites with their latest audit
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteWithLatestAuditList'
      '400':
        $ref: './responses.yaml#/400-no-audit-type'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
sites-for-organization:
  parameters:
    - $ref: './parameters.yaml#/organizationId'
  get:
    tags:
      - organization
      - site
    summary: Retrieve all sites for an organization
    description: |
      This endpoint is useful for retrieving all sites for an organization.
    operationId: getSitesForOrganization
    responses:
      '200':
        description: A list of sites
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/SiteList'
      '400':
        $ref: './responses.yaml#/400-no-organization-id'
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404-organization-not-found-with-id'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
      - ims_key: [ ]
      - scoped_api_key: [ ]

sites-by-organization-and-project-name:
  parameters:
    - name: organizationId
      in: path
      description: The ID of the organization
      required: true
      schema:
        $ref: './schemas.yaml#/Id'
    - name: projectName
      in: path
      description: The name of the project
      required: true
      schema:
        type: string
  get:
    tags:
      - site
    summary: Retrieve all sites by organization ID and project name
    description: |
      This endpoint is useful for retrieving all sites belonging to a specific project within an organization, identified by project name.
    operationId: getSitesByOrganizationIdAndProjectName
    responses:
      '200':
        description: A list of sites for the project
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: './schemas.yaml#/Site'
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
      - ims_key: [ ]
      - scoped_api_key: [ ]
