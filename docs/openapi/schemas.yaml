Id:
  type: string
  format: uuid
  readOnly: true
  example: '123e4567-e89b-12d3-a456-426614174000'
DateTime:
  type: string
  format: date-time
  example: '2024-01-19T14:20:30Z'
DeliveryType:
  type: string
  enum:
    - 'aem_edge'
    - 'aem_cs'
    - 'other'
  example: 'aem_edge'
AuditType:
  type: string
  enum:
    - '404'
    - 'apex'
    - 'cwv'
    - 'lhs'
    - 'lhs-desktop'
    - 'lhs-mobile'
    - 'broken-backlinks'
  example: 'cwv'
URL:
  type: string
  format: url
  example: 'https://www.example.com'
Site:
  type: object
  properties:
    id:
      description: The site ID in uuid format
      $ref: '#/Id'
    organizationId:
      description: The optional ID of the organization this site belongs to
      $ref: '#/Id'
    baseURL:
      description: The base URL of the site
      $ref: '#/URL'
    deliveryType:
      description: The type of the delivery this site is using
      $ref: '#/DeliveryType'
    gitHubURL:
      description: The optional GitHub URL of the site
      $ref: '#/URL'
    isLive:
      description: Whether the site is live or not
      type: boolean
    isLiveToggledAt:
      description: The date and time when the site was last toggled to live or non-live
      $ref: '#/DateTime'
    auditConfig:
      description: The audit configuration for this site
      $ref: '#/AuditConfig'
    createdAt:
      description: The date and time when the site was created
      $ref: '#/DateTime'
    updatedAt:
      description: The date and time when the site was last updated
      $ref: '#/DateTime'
  example:
    id: 'a1b2c3d4-e5f6-7g8h-9i0j-k11l12m13n14'
    organizationId: 'o1p2q3r4-s5t6-u7v8-w9x0-yz12x34y56z'
    baseURL: 'https://example-site.com'
    deliveryType: 'aem_edge'
    gitHubURL: 'https://github.com/example/repo'
    isLive: true
    isLiveToggledAt: '2024-01-20T10:00:00Z'
    auditConfig:
      auditsDisabled: false
      auditTypeConfigs:
        '404':
          disabled: true
        'cwv':
          disabled: false
    createdAt: '2023-12-15T09:30:00Z'
    updatedAt: '2024-01-19T11:20:00Z'
SiteWithLatestAudit:
  allOf:
    - $ref: '#/Site'
    - type: object
      properties:
        audits:
          description: An array with the latest audit for the given audit type
          type: array
          items:
            $ref: '#/Audit'
  example:
    id: 'a1b2c3d4-e5f6-7g8h-9i0j-k11l12m13n14'
    organizationId: 'o1p2q3r4-s5t6-u7v8-w9x0-yz12x34y56z'
    baseURL: 'https://example-site.com'
    deliveryType: 'aem_edge'
    gitHubURL: 'https://github.com/example/repo'
    isLive: true
    isLiveToggledAt: '2024-01-20T10:00:00Z'
    auditConfig:
      auditsDisabled: false
      auditTypeConfigs:
        '404':
          disabled: true
        'cwv':
          disabled: false
    createdAt: '2023-12-15T09:30:00Z'
    updatedAt: '2024-01-19T11:20:00Z'
    audits:
      - siteId: 'a1b2c3d4-e5f6-7g8h-9i0j-k11l12m13n14'
        auditedAt: '2024-01-20T12:00:00Z'
        expiresAt: '2024-07-20T12:00:00Z'
        auditType: 'cwv'
        isError: false
        isLive: true
        fullAuditRef: 'https://some-audit-system/full-report/1234'
        auditResult:
            lcp: 1234
            cls: 0.1234
            fcp: 1234
            tbt: 1234
            tti: 1234
        previousAuditResult:
            lcp: 1234
            cls: 0.1234
            fcp: 1234
            tbt: 1234
            tti: 1234
SiteList:
  type: array
  items:
    $ref: './schemas.yaml#/Site'
SiteCreate:
  type: object
  required:
    - baseURL
    - deliveryType
  properties:
    organizationId:
      description: The optional ID of the organization this site belongs to
      default: null
      $ref: '#/Id'
    baseURL:
      description: The base URL of the site
      $ref: '#/URL'
    deliveryType:
      description: The type of the delivery this site is using
      $ref: '#/DeliveryType'
    gitHubURL:
      description: The optional GitHub URL of the site
      $ref: '#/URL'
    isLive:
      description: Whether the site is live or not.
      default: false
      type: boolean
    auditConfig:
      description: The audit configuration for this site
      $ref: '#/AuditConfig'
  example:
    organizationId: 'o1p2q3r4-s5t6-u7v8-w9x0-yz12x34y56z'
    baseURL: 'https://www.newsite.com'
    deliveryType: 'aem_cs'
SiteUpdate:
  type: object
  properties:
    organizationId:
      description: The optional ID of the organization this site belongs to
      $ref: '#/Id'
    deliveryType:
      description: The type of the delivery this site is using
      $ref: '#/DeliveryType'
    isLive:
      description: Whether the site is live or not.
      type: boolean
    auditConfig:
      description: The audit configuration for this site
      $ref: '#/AuditConfig'
  example:
    organizationId: 'u7y6t5r4-e3w2-x1z0-z9y8-x7v6w5u4t3s2'
    deliveryType: 'other'
    isLive: true
AuditConfigType:
  type: object
  properties:
    disabled:
      description: Whether audits are disabled for the given audit type
      type: boolean
  example:
    disabled: true
AuditConfig:
  type: object
  properties:
    auditsDisabled:
      description: Whether audits are disabled for this site
      type: boolean
    auditTypeConfigs:
      type: object
      additionalProperties:
        $ref: '#/AuditConfigType'
  example:
    auditsDisabled: false
    auditTypeConfigs:
      '404':
        disabled: true
      'cwv':
        disabled: false
Audit:
  type: object
  readOnly: true
  properties:
    siteId:
      description: The ID of the site this audit belongs to
      $ref: '#/Id'
    auditedAt:
      description: The date and time of the audit in ISO 8601 format
      $ref: '#/DateTime'
    expiresAt:
      description: The date and time when the audit expires in ISO 8601 format
      $ref: '#/DateTime'
    auditType:
      description: The type of the audit
      $ref: '#/AuditType'
    isError:
      type: boolean
    isLive:
      type: boolean
    fullAuditRef:
      description: |
        A reference by which the full external result of an audit can be accessed, which is dependent on the audit type.
      type: string
    auditResult:
      $ref: '#/AuditResult'
    previousAuditResult:
      $ref: '#/AuditResult'
  example:
    siteId: 'a1b2c3d4-e5f6-7g8h-9i0j-k11l12m13n14'
    auditedAt: '2024-01-20T12:00:00Z'
    expiresAt: '2024-07-20T12:00:00Z'
    auditType: 'cwv'
    isError: false
    isLive: true
    fullAuditRef: 'https://some-audit-system/full-report/1234'
    auditResult:
        lcp: 1234
        cls: 0.1234
        fcp: 1234
        tbt: 1234
        tti: 1234
    previousAuditResult:
        lcp: 1234
        cls: 0.1234
        fcp: 1234
        tbt: 1234
        tti: 1234
AuditResult:
  type: object
  description: |
    The result of an audit, which is dependent on the audit type.
  additionalProperties: true
AuditList:
  type: array
  items:
    $ref: './schemas.yaml#/Audit'
FulfillmentCompletedEvent:
  type: object
  required:
    - external_request_id
    - requestor_id
    - owner_id
    - request_type
    - requestor_system
    - fulfillment_id
    - create_date
    - items
  properties:
    external_request_id:
      description: TODO continue here
      type: string
  example:
    external_request_id: ''
    requestor_id: ''
    owner_id: ''
    request_type: ''
    requestor_system: ''
    fulfillment_id: ''
    create_date: ''
    items: []
