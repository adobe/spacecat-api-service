llmo-sheet-data:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: dataSource
      in: path
      required: true
      description: The data source identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'questions'
  get:
    tags:
      - llmo
    summary: Get LLMO sheet data
    description: |
      Retrieves data from the external LLMO data endpoint for a specific site.
      This endpoint proxies data from the external HLX API based on the site's LLMO configuration.
    operationId: getLlmoSheetData
    responses:
      '200':
        description: LLMO sheet data retrieved successfully
        content:
          application/json:
            schema:
              type: object
              description: The data returned from the external LLMO endpoint
              additionalProperties: true
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  post:
    tags:
      - llmo
    summary: Query LLMO sheet data with filters, exclusions, and grouping
    description: |
      Retrieves and processes data from the external LLMO data endpoint for a specific site with advanced querying capabilities.
      This endpoint allows filtering data with case-insensitive exact matching, excluding specific fields from the response,
      and grouping data by specified attributes. The endpoint fetches all available data (up to 1M records) to apply
      the query operations effectively.
    operationId: queryLlmoSheetData
    requestBody:
      required: false
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoSheetDataQuery'
    responses:
      '200':
        description: LLMO sheet data queried and processed successfully
        content:
          application/json:
            schema:
              type: object
              description: The processed data returned from the external LLMO endpoint after applying filters, exclusions, and grouping
              additionalProperties: true
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-sheet-data-with-type:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: sheetType
      in: path
      required: true
      description: The sheet type identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'analytics'
    - name: dataSource
      in: path
      required: true
      description: The data source identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'questions'
  get:
    tags:
      - llmo
    summary: Get LLMO sheet data with sheet type
    description: |
      Retrieves data from the external LLMO data endpoint for a specific site with a specified sheet type.
      This endpoint proxies data from the external HLX API based on the site's LLMO configuration.
      The data is fetched from the path: {dataFolder}/{sheetType}/{dataSource}.json
    operationId: getLlmoSheetDataWithType
    responses:
      '200':
        description: LLMO sheet data retrieved successfully
        content:
          application/json:
            schema:
              type: object
              description: The data returned from the external LLMO endpoint
              additionalProperties: true
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  post:
    tags:
      - llmo
    summary: Query LLMO sheet data with sheet type using filters, exclusions, and grouping
    description: |
      Retrieves and processes data from the external LLMO data endpoint for a specific site with a specified sheet type
      and advanced querying capabilities. This endpoint allows filtering data with case-insensitive exact matching,
      excluding specific fields from the response, and grouping data by specified attributes.
      The data is fetched from the path: {dataFolder}/{sheetType}/{dataSource}.json
      The endpoint fetches all available data (up to 1M records) to apply the query operations effectively.
    operationId: queryLlmoSheetDataWithType
    requestBody:
      required: false
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoSheetDataQuery'
    responses:
      '200':
        description: LLMO sheet data queried and processed successfully
        content:
          application/json:
            schema:
              type: object
              description: The processed data returned from the external LLMO endpoint after applying filters, exclusions, and grouping
              additionalProperties: true
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-sheet-data-with-type-and-week:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: sheetType
      in: path
      required: true
      description: The sheet type identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'analytics'
    - name: week
      in: path
      required: true
      description: The week identifier (e.g., w01, w02) to fetch time-series data
      schema:
        type: string
        pattern: '^w\d{2}$'
        example: 'w01'
    - name: dataSource
      in: path
      required: true
      description: The data source identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'questions'
  get:
    tags:
      - llmo
    summary: Get LLMO sheet data with sheet type and week
    description: |
      Retrieves data from the external LLMO data endpoint for a specific site with a specified sheet type and week.
      This endpoint proxies data from the external HLX API based on the site's LLMO configuration.
      The data is fetched from the path: {dataFolder}/{sheetType}/{week}/{dataSource}.json
      This is useful for fetching time-series data organized by week.
    operationId: getLlmoSheetDataWithTypeAndWeek
    responses:
      '200':
        description: LLMO sheet data retrieved successfully
        content:
          application/json:
            schema:
              type: object
              description: The data returned from the external LLMO endpoint
              additionalProperties: true
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  post:
    tags:
      - llmo
    summary: Query LLMO sheet data with sheet type and week using filters, exclusions, and grouping
    description: |
      Retrieves and processes data from the external LLMO data endpoint for a specific site with a specified sheet type,
      week, and advanced querying capabilities. This endpoint allows filtering data with case-insensitive exact matching,
      excluding specific fields from the response, and grouping data by specified attributes.
      The data is fetched from the path: {dataFolder}/{sheetType}/{week}/{dataSource}.json
      The endpoint fetches all available data (up to 1M records) to apply the query operations effectively.
      This is useful for fetching and analyzing time-series data organized by week.
    operationId: queryLlmoSheetDataWithTypeAndWeek
    requestBody:
      required: false
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoSheetDataQuery'
    responses:
      '200':
        description: LLMO sheet data queried and processed successfully
        content:
          application/json:
            schema:
              type: object
              description: The processed data returned from the external LLMO endpoint after applying filters, exclusions, and grouping
              additionalProperties: true
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-data:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: file
      in: query
      required: false
      description: One or more file paths to fetch (comma-separated or multiple query params). Used for multi-file mode when no path parameters are provided.
      schema:
        type: string
        example: 'analytics/questions.json,analytics/answers.json'
    - name: filter.*
      in: query
      required: false
      description: Filter results by field values (e.g., filter.status=active, filter.category=cat1). Multiple filters are ANDed together with case-insensitive exact matching.
      schema:
        type: string
    - name: include
      in: query
      required: false
      description: Comma-separated list of fields to include in the response
      schema:
        type: string
        example: 'field1,field2,field3'
    - name: sort
      in: query
      required: false
      description: Sort results by field in ascending or descending order (format - field:asc or field:desc)
      schema:
        type: string
        example: 'date:desc'
    - name: sheets
      in: query
      required: false
      description: Comma-separated list of sheet names to include (for multi-sheet data)
      schema:
        type: string
        example: 'sheet1,sheet2'
    - name: limit
      in: query
      required: false
      description: Maximum number of records to return
      schema:
        type: integer
        default: 10000000
    - name: offset
      in: query
      required: false
      description: Number of records to skip
      schema:
        type: integer
        default: 0
    - name: sheet
      in: query
      required: false
      description: Specific sheet name to fetch from the data source
      schema:
        type: string
  get:
    tags:
      - llmo
    summary: Query LLMO data files with filters and sorting
    description: |
      Retrieves and processes data from the external LLMO data endpoint with advanced querying capabilities via URL parameters.
      This endpoint supports two modes:

      **Multi-file mode**: Use the `file` query parameter to fetch multiple files at once (up to 7 concurrent requests).
      Each file is processed independently and returned in a results array.

      **Single-file mode**: The endpoint will look for dataSource in the path and fetch that specific file.

      Query parameters allow filtering, field inclusion, sorting, and sheet selection. This is an optimized
      alternative to the POST endpoints that uses GET requests with URL parameters for caching and simplicity.
    operationId: queryLlmoData
    responses:
      '200':
        description: LLMO data queried and processed successfully
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  description: Single file response with processed data
                  properties:
                    data:
                      type: object
                      description: The processed data
                    headers:
                      type: object
                      description: Response headers from upstream
                - type: array
                  description: Multi-file response with array of results
                  items:
                    type: object
                    properties:
                      path:
                        type: string
                        description: The file path that was fetched
                      status:
                        type: string
                        enum: [success, error]
                        description: The status of the fetch operation
                      data:
                        type: object
                        description: The processed data (only present if status is success)
                      error:
                        type: string
                        description: Error message (only present if status is error)
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-data-with-datasource:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: dataSource
      in: path
      required: true
      description: The data source identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'questions.json'
    - name: filter.*
      in: query
      required: false
      description: Filter results by field values (e.g., filter.status=active)
      schema:
        type: string
    - name: include
      in: query
      required: false
      description: Comma-separated list of fields to include in the response
      schema:
        type: string
    - name: sort
      in: query
      required: false
      description: Sort results by field (format - field:asc or field:desc)
      schema:
        type: string
    - name: sheets
      in: query
      required: false
      description: Comma-separated list of sheet names to include
      schema:
        type: string
    - name: limit
      in: query
      required: false
      description: Maximum number of records to return
      schema:
        type: integer
    - name: offset
      in: query
      required: false
      description: Number of records to skip
      schema:
        type: integer
    - name: sheet
      in: query
      required: false
      description: Specific sheet name to fetch from the data source
      schema:
        type: string
  get:
    tags:
      - llmo
    summary: Query LLMO data for a specific data source
    description: |
      Retrieves and processes data from a specific data source file with query parameters for filtering,
      field inclusion, sorting, and sheet selection. The data is fetched from {dataFolder}/{dataSource}.
    operationId: queryLlmoDataWithSource
    responses:
      '200':
        description: LLMO data queried successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
                  description: The processed data
                headers:
                  type: object
                  description: Response headers
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-data-with-type:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: sheetType
      in: path
      required: true
      description: The sheet type identifier
      schema:
        type: string
        example: 'analytics'
    - name: dataSource
      in: path
      required: true
      description: The data source identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'questions.json'
    - name: filter.*
      in: query
      required: false
      description: Filter results by field values
      schema:
        type: string
    - name: include
      in: query
      required: false
      description: Comma-separated list of fields to include
      schema:
        type: string
    - name: sort
      in: query
      required: false
      description: Sort results by field
      schema:
        type: string
    - name: sheets
      in: query
      required: false
      description: Comma-separated list of sheet names to include
      schema:
        type: string
    - name: limit
      in: query
      required: false
      description: Maximum number of records to return
      schema:
        type: integer
    - name: offset
      in: query
      required: false
      description: Number of records to skip
      schema:
        type: integer
    - name: sheet
      in: query
      required: false
      description: Specific sheet name to fetch
      schema:
        type: string
  get:
    tags:
      - llmo
    summary: Query LLMO data with sheet type
    description: |
      Retrieves and processes data with a specified sheet type. The data is fetched from
      {dataFolder}/{sheetType}/{dataSource}. Supports query parameters for filtering, sorting, and field selection.
    operationId: queryLlmoDataWithType
    responses:
      '200':
        description: LLMO data queried successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
                headers:
                  type: object
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-data-with-type-and-week:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: sheetType
      in: path
      required: true
      description: The sheet type identifier
      schema:
        type: string
        example: 'analytics'
    - name: week
      in: path
      required: true
      description: The week identifier (e.g., w01, w02)
      schema:
        type: string
        pattern: '^w\d{2}$'
        example: 'w01'
    - name: dataSource
      in: path
      required: true
      description: The data source identifier
      schema:
        type: string
        example: 'questions.json'
    - name: filter.*
      in: query
      required: false
      description: Filter results by field values
      schema:
        type: string
    - name: include
      in: query
      required: false
      description: Comma-separated list of fields to include
      schema:
        type: string
    - name: sort
      in: query
      required: false
      description: Sort results by field
      schema:
        type: string
    - name: sheets
      in: query
      required: false
      description: Comma-separated list of sheet names to include
      schema:
        type: string
    - name: limit
      in: query
      required: false
      description: Maximum number of records to return
      schema:
        type: integer
    - name: offset
      in: query
      required: false
      description: Number of records to skip
      schema:
        type: integer
    - name: sheet
      in: query
      required: false
      description: Specific sheet name to fetch
      schema:
        type: string
  get:
    tags:
      - llmo
    summary: Query LLMO data with sheet type and week
    description: |
      Retrieves and processes time-series data with a specified sheet type and week. The data is fetched from
      {dataFolder}/{sheetType}/{week}/{dataSource}. Supports query parameters for filtering, sorting, and field selection.
    operationId: queryLlmoDataWithTypeAndWeek
    responses:
      '200':
        description: LLMO data queried successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                data:
                  type: object
                headers:
                  type: object
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-global-sheet-data:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: configName
      in: path
      required: true
      description: The data source identifier to fetch from the external endpoint
      schema:
        type: string
        example: 'questions'
  get:
    tags:
      - llmo
    summary: Get LLMO global sheet data
    description: |
      Retrieves data from the external LLMO global data endpoint for a specific site.
      This endpoint proxies data from the external HLX API using the global 'llmo-global' folder,
      independent of the site's LLMO configuration dataFolder.
    operationId: getLlmoGlobalSheetData
    responses:
      '200':
        description: LLMO global sheet data retrieved successfully
        content:
          application/json:
            schema:
              type: object
              description: The data returned from the external LLMO endpoint
              additionalProperties: true
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-config:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - $ref: './parameters.yaml#/llmoConfigVersion'
  get:
    tags:
      - llmo
    summary: Get LLMO configuration
    description: |
      Retrieves the LLMO (Large Language Model Optimizer) configuration for a specific site.
      This endpoint retrieves the configuration directly from S3 storage. The configuration
      includes entities (categories, topics), brand aliases, and competitor information.
      Categories may include optional URLs for content matching.

      If a version parameter is provided, the specific version of the configuration will be
      retrieved. If the version does not exist, a 404 error will be returned. If no version
      is provided, the latest version will be returned, or a default configuration if none
      exists.
    operationId: getLlmoConfig
    responses:
      '200':
        description: LLMO configuration retrieved successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                config:
                  $ref: './schemas.yaml#/LlmoConfig'
                version:
                  oneOf:
                    - type: string
                      example: "abc123def456"
                    - type: "null"
                  description: The S3 object version ID of the configuration, or null if default configuration is returned
              required:
                - config
                - version
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '404':
        $ref: './responses.yaml#/404-configuration-not-found-with-version'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  post:
    tags:
      - llmo
    summary: Update LLMO configuration
    description: |
      Updates the LLMO (Large Language Model Optimizer) configuration for a specific site.
      This operation completely overwrites the existing configuration with the provided payload.
      The payload is validated against the LLMO configuration schema before being stored in S3.
      The configuration must include entities, brands, and competitors sections.

      Categories can optionally include URLs that can be either exact URLs or URL prefixes
      (ending with /*) to match against specific content areas.
    operationId: postLlmoConfig
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoConfig'
    responses:
      '200':
        description: LLMO configuration updated successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                version:
                  type: string
                  description: The S3 object version ID of the updated configuration
                  example: "abc123def456"
              required:
                - version
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-onboard:
  post:
    tags:
      - llmo
    summary: Onboard new customer to LLMO
    description: |
      Onboards a net new customer to LLMO (Large Language Model Optimizer).
      This endpoint handles the complete onboarding process including organization validation,
      site creation/validation, LLMO configuration setup, and initial analysis trigger.
      The IMS Organization ID is automatically extracted from the user's JWT token (sub property).
    operationId: onboardCustomer
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              domain:
                type: string
                format: hostname
                description: The domain name to onboard (without protocol)
                example: "example.com"
              brandName:
                type: string
                description: The brand name for the site
                example: "Example Brand"
            required:
              - domain
              - brandName
    responses:
      '200':
        description: LLMO onboarding initiated successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  description: Success message
                  example: "LLMO onboarding initiated successfully"
                domain:
                  type: string
                  format: hostname
                  description: The domain name
                  example: "example.com"
                brandName:
                  type: string
                  description: The brand name
                  example: "Example Brand"
                imsOrgId:
                  type: string
                  description: The IMS Organization ID
                  example: "1234567890ABCDEF@AdobeOrg"
                organizationId:
                  type: string
                  format: uuid
                  description: The organization ID (created or existing)
                  example: "123e4567-e89b-12d3-a456-426614174000"
                siteId:
                  type: string
                  format: uuid
                  description: The created or existing site ID
                  example: "987fcdeb-51a2-43d1-9f12-345678901234"
                status:
                  type: string
                  enum: ["initiated", "in_progress", "completed", "failed"]
                  description: The onboarding status
                  example: "initiated"
                createdAt:
                  type: string
                  format: date-time
                  description: The timestamp when onboarding was initiated
                  example: "2025-01-15T10:30:00Z"
              required:
                - message
                - domain
                - brandName
                - imsOrgId
                - status
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '403':
        $ref: './responses.yaml#/403'
      '500':
        $ref: './responses.yaml#/500'
    security: []

llmo-offboard:
  parameters:
    - $ref: './parameters.yaml#/siteId'
  post:
    tags:
      - llmo
    summary: Offboard customer from LLMO
    description: |
      Offboards a customer from LLMO (Large Language Model Optimizer).
      This endpoint handles disabling audits and cleaning up LLMO configuration for a site.
      The site must have LLMO enabled and the user must have appropriate permissions.
    operationId: offboardCustomer
    responses:
      '200':
        description: LLMO offboarding completed successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  description: Success message
                  example: "LLMO offboarding completed successfully"
                siteId:
                  type: string
                  format: uuid
                  description: The site ID that was offboarded
                  example: "987fcdeb-51a2-43d1-9f12-345678901234"
                baseURL:
                  type: string
                  format: uri
                  description: The site's base URL
                  example: "https://example.com"
                status:
                  type: string
                  enum: ["completed", "failed"]
                  description: The offboarding status
                  example: "completed"
                completedAt:
                  type: string
                  format: date-time
                  description: The timestamp when offboarding was completed
                  example: "2025-01-15T10:30:00Z"
              required:
                - message
                - siteId
                - status
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '403':
        $ref: './responses.yaml#/403'
      '404':
        $ref: './responses.yaml#/404'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-questions:
  parameters:
    - $ref: './parameters.yaml#/siteId'
  get:
    tags:
      - llmo
    summary: Get LLMO questions
    description: |
      Retrieves all LLMO questions (both human and AI) for a specific site.
      Returns an object with Human and AI question arrays.
    operationId: getLlmoQuestions
    responses:
      '200':
        description: LLMO questions retrieved successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoQuestions'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  post:
    tags:
      - llmo
    summary: Add LLMO questions
    description: |
      Adds new questions to the LLMO configuration for a specific site.
      Questions can be added to both Human and AI categories.
    operationId: addLlmoQuestion
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoQuestionsInput'
    responses:
      '200':
        description: LLMO questions added successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoQuestions'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-question:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: questionKey
      in: path
      required: true
      description: The unique key of the question to modify
      schema:
        type: string
        format: uuid
        example: '123e4567-e89b-12d3-a456-426614174000'
  delete:
    tags:
      - llmo
    summary: Remove LLMO question
    description: |
      Removes a specific question from the LLMO configuration by its unique key.
      The question can be from either Human or AI categories.
    operationId: removeLlmoQuestion
    responses:
      '200':
        description: LLMO question removed successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoQuestions'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  patch:
    tags:
      - llmo
    summary: Update LLMO question
    description: |
      Updates a specific question in the LLMO configuration by its unique key.
      The question can be from either Human or AI categories.
    operationId: patchLlmoQuestion
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoQuestionUpdate'
    responses:
      '200':
        description: LLMO question updated successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoQuestions'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-customer-intent:
  parameters:
    - $ref: './parameters.yaml#/siteId'
  get:
    tags:
      - llmo
    summary: Get LLMO customer intent
    description: |
      Retrieves all LLMO customer intent key-value pairs for a specific site.
      Returns an array of customer intent items with key and value properties.
    operationId: getLlmoCustomerIntent
    responses:
      '200':
        description: LLMO customer intent retrieved successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoCustomerIntent'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  post:
    tags:
      - llmo
    summary: Add LLMO customer intent
    description: |
      Adds new customer intent items to the LLMO configuration for a specific site.
      Customer intent items are key-value pairs that define customer targeting and goals.
    operationId: addLlmoCustomerIntent
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoCustomerIntentInput'
    responses:
      '200':
        description: LLMO customer intent added successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoCustomerIntent'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-customer-intent-item:
  parameters:
    - $ref: './parameters.yaml#/siteId'
    - name: intentKey
      in: path
      required: true
      description: The unique key of the customer intent item to modify
      schema:
        type: string
        example: 'target_audience'
  delete:
    tags:
      - llmo
    summary: Remove LLMO customer intent item
    description: |
      Removes a specific customer intent item from the LLMO configuration by its key.
      The key should match an existing customer intent item.
    operationId: removeLlmoCustomerIntent
    responses:
      '200':
        description: LLMO customer intent item removed successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoCustomerIntent'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
  patch:
    tags:
      - llmo
    summary: Update LLMO customer intent item
    description: |
      Updates a specific customer intent item in the LLMO configuration by its key.
      You can update either the key, value, or both properties.
    operationId: patchLlmoCustomerIntent
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: './schemas.yaml#/LlmoCustomerIntentUpdate'
    responses:
      '200':
        description: LLMO customer intent item updated successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoCustomerIntent'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-cdn-logs-filter:
  parameters:
    - $ref: './parameters.yaml#/siteId'
  patch:
    tags:
      - llmo
    summary: Update LLMO CDN logs filter configuration
    description: |
      Updates the CDN logs filter configuration for a specific site.
    operationId: patchLlmoCdnLogsFilter
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              cdnlogsFilter:
                $ref: './schemas.yaml#/LlmoCdnLogsFilter'
    responses:
      '200':
        description: LLMO CDN logs filter updated successfully
        content:
          application/json:
            schema:
              $ref: './schemas.yaml#/LlmoCdnLogsFilter'
      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

      '400':
        $ref: './responses.yaml#/400'
      '401':
        $ref: './responses.yaml#/401'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]

llmo-brand-presence-filters:
  parameters:
    - $ref: './parameters.yaml#/siteId'
  get:
    tags:
      - llmo
      - brand-presence
    summary: Get distinct brand presence filter values
    description: |
      Retrieves all distinct values for each filter dimension from the brand_presence table in the Aurora PostgreSQL database.
      This endpoint returns unique categories, topics, models (platforms), regions, and origins that can be used to
      populate filter dropdowns in the UI, enabling optimal filter selection without loading all data on the client side.
      
      This is part of the performance optimization for the brand presence dashboard, where instead of fetching all data
      and computing filter values on the client, we make a targeted database query to get only the distinct values needed.
      
      **Prerequisites:**
      - Aurora/PostgreSQL database must be configured
      - `ENABLE_AURORA_QUERIES` environment variable must be set to `true`
      - Site must have LLMO enabled and user must have access to the site
      
      **Performance:**
      - Uses optimized queries with DISTINCT and proper indexing
      - Returns performance metrics for monitoring and optimization
    operationId: getBrandPresenceFilters
    responses:
      '200':
        description: Filter values retrieved successfully
        content:
          application/json:
            schema:
              type: object
              required:
                - siteId
                - filters
                - performance
              properties:
                siteId:
                  type: string
                  format: uuid
                  description: The site ID that the filters were retrieved for
                  example: 'c2473d89-e997-458d-a86d-b4096649c12b'
                filters:
                  type: object
                  required:
                    - categories
                    - topics
                    - models
                    - regions
                    - origins
                  properties:
                    categories:
                      type: array
                      items:
                        type: string
                      description: Distinct category values available for filtering
                      example: ['Adobe', 'Marketing', 'Technology']
                    topics:
                      type: array
                      items:
                        type: string
                      description: Distinct topic values available for filtering (extracted from comma-separated topics field)
                      example: ['AI', 'Cloud Computing', 'Design']
                    models:
                      type: array
                      items:
                        type: string
                      description: Distinct model/platform values available for filtering
                      example: ['chatgpt', 'gemini', 'copilot', 'perplexity']
                    regions:
                      type: array
                      items:
                        type: string
                      description: Distinct region values available for filtering
                      example: ['US', 'EU', 'APAC']
                    origins:
                      type: array
                      items:
                        type: string
                      description: Distinct origin values available for filtering
                      example: ['google', 'openai', 'microsoft']
                performance:
                  type: object
                  required:
                    - totalDuration
                    - queryDuration
                    - validationDuration
                  properties:
                    totalDuration:
                      type: number
                      description: Total request duration in milliseconds
                      example: 125
                    queryDuration:
                      type: number
                      description: Database query duration in milliseconds
                      example: 95
                    validationDuration:
                      type: number
                      description: LLMO access validation duration in milliseconds
                      example: 15
      '400':
        $ref: './responses.yaml#/400'
        description: |
          Bad request. Possible reasons:
          - Aurora database is not configured
          - ENABLE_AURORA_QUERIES is not enabled
          - Database query failed
          - Site not found
      '401':
        $ref: './responses.yaml#/401'
      '403':
        description: Forbidden - User does not have access to the site
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: 'Only users belonging to the organization can view its sites'
      '500':
        $ref: './responses.yaml#/500'
    security:
      - api_key: [ ]
